# HTTPS

HTTPS的握手过程就是在HTTP握手的基础上，多了一个TLS的握手过程。

## TLS握手过程

1. CLient Hello，即发送`client_random、TLS版本、加密套件列表`,
2. Server Hello，发送`server_random、server_params、确认TLS版本、使用的加密套件列表、服务器使用的证书`
3. Client验证证书，生成`secret`，客户端验证服务器的证书和签名，如果通过则发送`client_params`参数给服务器，然后客户端用`clinet_params,server_params`计算出`pre_random`，然后用`client_random,server_random,pre_random`计算最终的secret
4. 服务器也拥有`client_random,server_random,pre_random`，也用这三个数来生成secret
5. 最终的通信都用这个secret来作为对称加密的密钥

## HTTPS握手过程

首先发起TLS握手，客户端先向服务器请求，发送一个`客户端随机数，TLS可用版本列表和一系列的加密套件，比如之后用什么算法来进行加解密`，服务器收到以后，返回`服务器随机数，服务器的一个参数，确认的TLS版本，确认的加密套件列表和服务器使用的证书`，客户端接收到以后，先验证证书，如果证书验证有问题，则提示风险，然后给服务器发送一个`客户端参数`，这是客户端会用`服务器参数和客户端参数`生成一个随机数，再结合`客户端随机数，服务器随机数`生成一个密钥，服务器在接收到`客户端参数`以后，也和客户端一样生成一个密钥，这时2个密钥是相同的，之后的加密就通过这两个密钥来进行对称加密通信。

## 为什么HTTPS可以预防中间人攻击？

HTTPS有个证书验证的过程，在握手阶段，服务器会把自己证书签名后发给客户端，其中签名就是用证书机构的私钥加密后的指纹（即hash值）和指纹算法，客户端得到后先验证证书的基础信息，如过期时间、网站域名等，再用公钥解密签名后，得到指纹和指纹算法，用指纹算法计算证书的内容得到另外一个指纹，对比两个指纹，如果相同则代表验证成功。

1. CA机构的私钥是绝对保密的，所以只拿到证书是没办法伪造指纹的，
2. 